{
    "info": {
        "_postman_id": "fhir-transformer-integration",
        "name": "FHIR Transformer Integration Tests",
        "description": "Comprehensive Integration tests for FHIR Transformer API",
        "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
    },
    "auth": {
        "type": "basic",
        "basic": [
            {
                "key": "password",
                "value": "admin123",
                "type": "string"
            },
            {
                "key": "username",
                "value": "admin",
                "type": "string"
            }
        ]
    },
    "item": [
        {
            "name": "Tenant Management",
            "item": [
                {
                    "name": "Onboard Tenant",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 200 or 400 (already exists)\", function () {",
                                    "    if (pm.response.code === 200) {",
                                    "        pm.response.to.have.status(200);",
                                    "    } else {",
                                    "        pm.response.to.have.status(400);",
                                    "        pm.expect(pm.response.text()).to.include(\"exists\");",
                                    "    }",
                                    "});",
                                    "if (pm.response.code === 200) {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.test(\"Tenant ID matches\", function () {",
                                    "        pm.expect(jsonData.tenantId).to.eql(\"tenant1\");",
                                    "    });",
                                    "    pm.test(\"Tenant Name matches\", function () {",
                                    "        pm.expect(jsonData.name).to.eql(\"Test Hospital\");",
                                    "    });",
                                    "}"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "basic",
                            "basic": [
                                {
                                    "key": "password",
                                    "value": "admin123",
                                    "type": "string"
                                },
                                {
                                    "key": "username",
                                    "value": "admin",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json",
                                "type": "text"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"tenantId\": \"tenant1\",\n    \"password\": \"password123\",\n    \"name\": \"Test Hospital\"\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/tenants/onboard",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "tenants",
                                "onboard"
                            ]
                        }
                    }
                },
                {
                    "name": "Update Tenant",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 200\", function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "var jsonData = pm.response.json();",
                                    "pm.test(\"Name is updated\", function () {",
                                    "    pm.expect(jsonData.name).to.eql(\"Updated Hospital Name\");",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "basic",
                            "basic": [
                                {
                                    "key": "password",
                                    "value": "admin123",
                                    "type": "string"
                                },
                                {
                                    "key": "username",
                                    "value": "admin",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "PUT",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json",
                                "type": "text"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"name\": \"Updated Hospital Name\"\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/tenants/tenant1",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "tenants",
                                "tenant1"
                            ]
                        }
                    }
                }
            ]
        },
        {
            "name": "HL7 to FHIR Conversions",
            "item": [
                {
                    "name": "Async ADT^A01 (Admission)",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 202\", function () {",
                                    "    pm.response.to.have.status(202);",
                                    "});",
                                    "pm.test(\"Response body indicates async processing\", function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData.status).to.eql(\"Accepted\");",
                                    "    pm.expect(jsonData.message).to.eql(\"Processing asynchronously\");",
                                    "});",
                                    "pm.test(\"Transaction ID matches MSH-10\", function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData.transactionId).to.eql(\"MSGID123\");",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "basic",
                            "basic": [
                                {
                                    "key": "password",
                                    "value": "password123",
                                    "type": "string"
                                },
                                {
                                    "key": "username",
                                    "value": "tenant1",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "text/plain",
                                "type": "text"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "MSH|^~\\&|HIS|RIH|EKG|EkG|199904140038||ADT^A01|MSGID123|P|2.5\rPID|1||100||DOE^JOHN||19700101|M||||||||||1000"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/convert/v2-to-fhir",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "convert",
                                "v2-to-fhir"
                            ]
                        }
                    }
                },
                {
                    "name": "Sync ADT^A01 (Full Patient + Encounter)",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 200\", function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "var jsonData = pm.response.json();",
                                    "pm.test(\"Is FHIR Bundle\", function () {",
                                    "    pm.expect(jsonData.resourceType).to.eql(\"Bundle\");",
                                    "});",
                                    "pm.test(\"Contains Patient\", function () {",
                                    "    var patient = jsonData.entry.find(e => e.resource.resourceType === \"Patient\");",
                                    "    pm.expect(patient).to.not.be.undefined;",
                                    "    pm.expect(patient.resource.name[0].family).to.eql(\"DOE\");",
                                    "});",
                                    "pm.test(\"Contains Encounter\", function () {",
                                    "    var encounter = jsonData.entry.find(e => e.resource.resourceType === \"Encounter\");",
                                    "    pm.expect(encounter).to.not.be.undefined;",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "basic",
                            "basic": [
                                {
                                    "key": "password",
                                    "value": "password123",
                                    "type": "string"
                                },
                                {
                                    "key": "username",
                                    "value": "tenant1",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "text/plain",
                                "type": "text"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "MSH|^~\\&|HIS|RIH|EKG|EkG|199904140038||ADT^A01|MSGID123|P|2.5\rPID|1||100||DOE^JOHN||19700101|M||||||||||1000\rPV1|1|I"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/convert/v2-to-fhir-sync",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "convert",
                                "v2-to-fhir-sync"
                            ]
                        }
                    }
                },
                {
                    "name": "Sync ADT^A08 (Patient Only - No PV1)",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 200\", function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "var jsonData = pm.response.json();",
                                    "pm.test(\"Contains Patient\", function () {",
                                    "    var patient = jsonData.entry.find(e => e.resource.resourceType === \"Patient\");",
                                    "    pm.expect(patient).to.not.be.undefined;",
                                    "    pm.expect(patient.resource.name[0].given[0]).to.eql(\"JANE\");",
                                    "});",
                                    "pm.test(\"Does NOT Contain Encounter\", function () {",
                                    "    var encounter = jsonData.entry.find(e => e.resource.resourceType === \"Encounter\");",
                                    "    pm.expect(encounter).to.be.undefined;",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "basic",
                            "basic": [
                                {
                                    "key": "password",
                                    "value": "password123",
                                    "type": "string"
                                },
                                {
                                    "key": "username",
                                    "value": "tenant1",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "text/plain",
                                "type": "text"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "MSH|^~\\&|HIS|RIH|EKG|EkG|199904140038||ADT^A08|MSGID456|P|2.5\rPID|1||101||DOE^JANE||19800101|F||||||||||1001"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/convert/v2-to-fhir-sync",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "convert",
                                "v2-to-fhir-sync"
                            ]
                        }
                    }
                },
                {
                    "name": "Sync Unknown Gender (PID-8)",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 200\", function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "var jsonData = pm.response.json();",
                                    "pm.test(\"Gender is Unknown\", function () {",
                                    "    var patient = jsonData.entry.find(e => e.resource.resourceType === \"Patient\");",
                                    "    pm.expect(patient.resource.gender).to.eql(\"unknown\");",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "basic",
                            "basic": [
                                {
                                    "key": "password",
                                    "value": "password123",
                                    "type": "string"
                                },
                                {
                                    "key": "username",
                                    "value": "tenant1",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "text/plain",
                                "type": "text"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "MSH|^~\\&|HIS|RIH|EKG|EkG|199904140038||ADT^A08|MSGID789|P|2.5\rPID|1||102||SMITH^ALEX||19900101|X||||||||||1002"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/convert/v2-to-fhir-sync",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "convert",
                                "v2-to-fhir-sync"
                            ]
                        }
                    }
                },
                {
                    "name": "Sync Bad HL7",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 400\", function () {",
                                    "    pm.response.to.have.status(400);",
                                    "});",
                                    "pm.test(\"Response contains error\", function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData.error).to.not.be.undefined;",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "basic",
                            "basic": [
                                {
                                    "key": "password",
                                    "value": "password123",
                                    "type": "string"
                                },
                                {
                                    "key": "username",
                                    "value": "tenant1",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "text/plain",
                                "type": "text"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "INVALID HEADER|..."
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/convert/v2-to-fhir-sync",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "convert",
                                "v2-to-fhir-sync"
                            ]
                        }
                    }
                }
            ]
        },
        {
            "name": "FHIR to HL7 Conversions",
            "item": [
                {
                    "name": "Async Bundle to HL7",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 202\", function () {",
                                    "    pm.response.to.have.status(202);",
                                    "});",
                                    "pm.test(\"Response body indicates async processing\", function () {",
                                    "    var textData = pm.response.text();",
                                    "    pm.expect(textData).to.include(\"Processing asynchronously\");",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json",
                                "type": "text"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"resourceType\": \"Bundle\",\n  \"type\": \"transaction\",\n  \"entry\": [\n    {\n      \"resource\": {\n        \"resourceType\": \"Patient\",\n        \"identifier\": [ { \"value\": \"ASYNC-123\" } ],\n        \"name\": [ { \"family\": \"SKYWALKER\", \"given\": [\"LUKE\"] } ],\n        \"gender\": \"male\"\n      }\n    }\n  ]\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/convert/fhir-to-v2",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "convert",
                                "fhir-to-v2"
                            ]
                        }
                    }
                },
                {
                    "name": "Bundle (Patient + Encounter)",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 200\", function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "var textData = pm.response.text();",
                                    "pm.test(\"Contains MSH, PID, PV1\", function () {",
                                    "    pm.expect(textData).to.include(\"MSH|\");",
                                    "    pm.expect(textData).to.include(\"PID|\");",
                                    "    pm.expect(textData).to.include(\"PV1|\");",
                                    "});",
                                    "pm.test(\"Contains Patient Data\", function () {",
                                    "    pm.expect(textData).to.include(\"SMITH\");",
                                    "});",
                                    "pm.test(\"Contains Visit Num\", function () {",
                                    "    pm.expect(textData).to.include(\"VISIT-001\");",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json",
                                "type": "text"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"resourceType\": \"Bundle\",\n  \"type\": \"transaction\",\n  \"entry\": [\n    {\n      \"resource\": {\n        \"resourceType\": \"Patient\",\n        \"identifier\": [ { \"value\": \"12345\" } ],\n        \"name\": [ { \"family\": \"SMITH\", \"given\": [\"JOHN\"] } ],\n        \"gender\": \"male\"\n      }\n    },\n    {\n      \"resource\": {\n        \"resourceType\": \"Encounter\",\n        \"identifier\": [ { \"value\": \"VISIT-001\" } ],\n        \"class\": { \"code\": \"I\" }\n      }\n    }\n  ]\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/convert/fhir-to-v2-sync",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "convert",
                                "fhir-to-v2-sync"
                            ]
                        }
                    }
                },
                {
                    "name": "Sync Bundle (Patient Only)",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 200\", function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "var textData = pm.response.text();",
                                    "pm.test(\"Contains PID\", function () {",
                                    "    pm.expect(textData).to.include(\"PID|\");",
                                    "});",
                                    "pm.test(\"Verify PV1 is empty/minimal or absent data\", function () {",
                                    "    // Since we know the code forces ADT^A01, PV1 might form but checks for values\n    pm.expect(textData).to.not.include(\"VISIT-001\");\n});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json",
                                "type": "text"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"resourceType\": \"Bundle\",\n  \"type\": \"transaction\",\n  \"entry\": [\n    {\n      \"resource\": {\n        \"resourceType\": \"Patient\",\n        \"identifier\": [ { \"value\": \"99999\" } ],\n        \"name\": [ { \"family\": \"SOLO\", \"given\": [\"HAN\"] } ],\n        \"gender\": \"male\"\n      }\n    }\n  ]\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/convert/fhir-to-v2-sync",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "convert",
                                "fhir-to-v2-sync"
                            ]
                        }
                    }
                },
                {
                    "name": "Sync Malformed FHIR",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 400\", function () {",
                                    "    pm.response.to.have.status(400);",
                                    "});",
                                    "pm.test(\"Contains Error Message\", function () {",
                                    "    pm.expect(pm.response.text()).to.match(/Error|error/);",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json",
                                "type": "text"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{ \"resourceType\": \"Bundle\", \"broken_json\": "
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/convert/fhir-to-v2-sync",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "convert",
                                "fhir-to-v2-sync"
                            ]
                        }
                    }
                },
                {
                    "name": "Sync Non-Bundle FHIR",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 400\", function () {",
                                    "    pm.response.to.have.status(400);",
                                    "});",
                                    "pm.test(\"Contains Error\", function () {",
                                    "    pm.expect(pm.response.text()).to.include(\"Error\");",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json",
                                "type": "text"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"resourceType\": \"Patient\",\n  \"id\": \"123\",\n  \"name\": [ { \"family\": \"TEST\" } ]\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/convert/fhir-to-v2-sync",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "convert",
                                "fhir-to-v2-sync"
                            ]
                        }
                    }
                }
            ]
        },
        {
            "name": "Operations",
            "item": [
                {
                    "name": "Health Check",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 200\", function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "pm.test(\"Status is UP\", function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData.status).to.eql(\"UP\");",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{baseUrl}}/actuator/health",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "actuator",
                                "health"
                            ]
                        }
                    }
                },
                {
                    "name": "Metrics",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 200\", function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{baseUrl}}/actuator/metrics",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "actuator",
                                "metrics"
                            ]
                        }
                    }
                }
            ]
        }
    ],
    "variable": [
        {
            "key": "baseUrl",
            "value": "http://localhost:8080",
            "type": "string"
        }
    ]
}