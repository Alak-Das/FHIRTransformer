{
    "info": {
        "_postman_id": "fhir-transformer-integration",
        "name": "FHIR Transformer Integration Tests",
        "description": "Comprehensive Integration tests for FHIR Transformer API",
        "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
    },
    "auth": {
        "type": "basic",
        "basic": [
            {
                "key": "password",
                "value": "password",
                "type": "string"
            },
            {
                "key": "username",
                "value": "admin",
                "type": "string"
            }
        ]
    },
    "item": [
        {
            "name": "Tenant Management",
            "item": [
                {
                    "name": "Onboard Tenant",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 200 or 400 (already exists)\", function () {",
                                    "    if (pm.response.code === 200) {",
                                    "        pm.response.to.have.status(200);",
                                    "    } else {",
                                    "        pm.response.to.have.status(400);",
                                    "        pm.expect(pm.response.text()).to.include(\"exists\");",
                                    "    }",
                                    "});",
                                    "if (pm.response.code === 200) {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.test(\"Tenant ID matches\", function () {",
                                    "        pm.expect(jsonData.tenantId).to.eql(\"tenant1\");",
                                    "    });",
                                    "    pm.test(\"Tenant Name matches\", function () {",
                                    "        pm.expect(jsonData.name).to.eql(\"Test Hospital\");",
                                    "    });",
                                    "}"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "basic",
                            "basic": [
                                {
                                    "key": "password",
                                    "value": "password",
                                    "type": "string"
                                },
                                {
                                    "key": "username",
                                    "value": "admin",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json",
                                "type": "text"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"tenantId\": \"tenant1\",\n    \"password\": \"password123\",\n    \"name\": \"Test Hospital\"\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/tenants/onboard",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "tenants",
                                "onboard"
                            ]
                        }
                    }
                },
                {
                    "name": "Get All Tenants",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 200\", function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "pm.test(\"Returns list\", function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData).to.be.an('array');",
                                    "    pm.expect(jsonData.length).to.be.above(0);",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "basic",
                            "basic": [
                                {
                                    "key": "password",
                                    "value": "password",
                                    "type": "string"
                                },
                                {
                                    "key": "username",
                                    "value": "admin",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{baseUrl}}/api/tenants",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "tenants"
                            ]
                        }
                    }
                }
            ]
        },
        {
            "name": "HL7 to FHIR Conversions",
            "item": [
                {
                    "name": "Async ADT^A01 (Admission)",
                    "event": [
                        {
                            "listen": "prerequest",
                            "script": {
                                "exec": [
                                    "var uuid = require('uuid');",
                                    "pm.environment.set(\"currentTransactionId\", uuid.v4());"
                                ],
                                "type": "text/javascript"
                            }
                        },
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 202\", function () {",
                                    "    pm.response.to.have.status(202);",
                                    "});",
                                    "pm.test(\"Response body indicates async processing\", function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData.status).to.eql(\"Accepted\");",
                                    "    pm.expect(jsonData.message).to.eql(\"Processing asynchronously\");",
                                    "});",
                                    "pm.test(\"Transaction ID matches MSH-10\", function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    var expectedId = pm.environment.get(\"currentTransactionId\");",
                                    "    pm.expect(jsonData.transactionId).to.eql(expectedId);",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "basic",
                            "basic": [
                                {
                                    "key": "password",
                                    "value": "password123",
                                    "type": "string"
                                },
                                {
                                    "key": "username",
                                    "value": "tenant1",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "text/plain",
                                "type": "text"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "MSH|^~\\&|HIS|RIH|EKG|EkG|199904140038||ADT^A01|{{currentTransactionId}}|P|2.5\rPID|1||100||DOE^JOHN||19700101|M||||||||||1000"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/convert/v2-to-fhir",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "convert",
                                "v2-to-fhir"
                            ]
                        }
                    }
                },
                {
                    "name": "Sync ADT^A01 (Full Patient + Encounter)",
                    "event": [
                        {
                            "listen": "prerequest",
                            "script": {
                                "exec": [
                                    "var uuid = require('uuid');",
                                    "pm.environment.set(\"syncAdt01Id\", uuid.v4());"
                                ],
                                "type": "text/javascript"
                            }
                        },
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 200\", function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "var jsonData = pm.response.json();",
                                    "pm.test(\"Is FHIR Bundle\", function () {",
                                    "    pm.expect(jsonData.resourceType).to.eql(\"Bundle\");",
                                    "});",
                                    "pm.test(\"Bundle ID Matches MSH-10\", function () {",
                                    "    var expectedId = pm.environment.get(\"syncAdt01Id\");",
                                    "    pm.expect(jsonData.id).to.eql(expectedId);",
                                    "});",
                                    "pm.test(\"Contains Patient\", function () {",
                                    "    var patient = jsonData.entry.find(e => e.resource.resourceType === \"Patient\");",
                                    "    pm.expect(patient).to.not.be.undefined;",
                                    "    pm.expect(patient.resource.name[0].family).to.eql(\"DOE\");",
                                    "});",
                                    "pm.test(\"Contains Encounter\", function () {",
                                    "    var encounter = jsonData.entry.find(e => e.resource.resourceType === \"Encounter\");",
                                    "    pm.expect(encounter).to.not.be.undefined;",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "basic",
                            "basic": [
                                {
                                    "key": "password",
                                    "value": "password123",
                                    "type": "string"
                                },
                                {
                                    "key": "username",
                                    "value": "tenant1",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "text/plain",
                                "type": "text"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "MSH|^~\\&|HIS|RIH|EKG|EkG|199904140038||ADT^A01|{{syncAdt01Id}}|P|2.5\rPID|1||100||DOE^JOHN||19700101|M||||||||||1000\rPV1|1|I"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/convert/v2-to-fhir-sync",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "convert",
                                "v2-to-fhir-sync"
                            ]
                        }
                    }
                },
                {
                    "name": "Sync ADT^A08 (Patient Only - No PV1)",
                    "event": [
                        {
                            "listen": "prerequest",
                            "script": {
                                "exec": [
                                    "var uuid = require('uuid');",
                                    "pm.environment.set(\"syncAdt08Id\", uuid.v4());"
                                ],
                                "type": "text/javascript"
                            }
                        },
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 200\", function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "var jsonData = pm.response.json();",
                                    "pm.test(\"Bundle ID Matches MSH-10\", function () {",
                                    "    var expectedId = pm.environment.get(\"syncAdt08Id\");",
                                    "    pm.expect(jsonData.id).to.eql(expectedId);",
                                    "});",
                                    "pm.test(\"Contains Patient\", function () {",
                                    "    var patient = jsonData.entry.find(e => e.resource.resourceType === \"Patient\");",
                                    "    pm.expect(patient).to.not.be.undefined;",
                                    "    pm.expect(patient.resource.name[0].given[0]).to.eql(\"JANE\");",
                                    "});",
                                    "pm.test(\"Does NOT Contain Encounter\", function () {",
                                    "    var encounter = jsonData.entry.find(e => e.resource.resourceType === \"Encounter\");",
                                    "    pm.expect(encounter).to.be.undefined;",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "basic",
                            "basic": [
                                {
                                    "key": "password",
                                    "value": "password123",
                                    "type": "string"
                                },
                                {
                                    "key": "username",
                                    "value": "tenant1",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "text/plain",
                                "type": "text"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "MSH|^~\\&|HIS|RIH|EKG|EkG|199904140038||ADT^A08|{{syncAdt08Id}}|P|2.5\rPID|1||101||DOE^JANE||19800101|F||||||||||1001"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/convert/v2-to-fhir-sync",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "convert",
                                "v2-to-fhir-sync"
                            ]
                        }
                    }
                },
                {
                    "name": "Sync Unknown Gender (PID-8)",
                    "event": [
                        {
                            "listen": "prerequest",
                            "script": {
                                "exec": [
                                    "var uuid = require('uuid');",
                                    "pm.environment.set(\"syncUnknownId\", uuid.v4());"
                                ],
                                "type": "text/javascript"
                            }
                        },
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 200\", function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "var jsonData = pm.response.json();",
                                    "pm.test(\"Bundle ID Matches MSH-10\", function () {",
                                    "    var expectedId = pm.environment.get(\"syncUnknownId\");",
                                    "    pm.expect(jsonData.id).to.eql(expectedId);",
                                    "});",
                                    "pm.test(\"Gender is Unknown\", function () {",
                                    "    var patient = jsonData.entry.find(e => e.resource.resourceType === \"Patient\");",
                                    "    pm.expect(patient.resource.gender).to.eql(\"unknown\");",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "basic",
                            "basic": [
                                {
                                    "key": "password",
                                    "value": "password123",
                                    "type": "string"
                                },
                                {
                                    "key": "username",
                                    "value": "tenant1",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "text/plain",
                                "type": "text"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "MSH|^~\\&|HIS|RIH|EKG|EkG|199904140038||ADT^A08|{{syncUnknownId}}|P|2.5\rPID|1||102||SMITH^ALEX||19900101|X||||||||||1002"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/convert/v2-to-fhir-sync",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "convert",
                                "v2-to-fhir-sync"
                            ]
                        }
                    }
                },
                {
                    "name": "Sync ADT^A01 (Patient + Diagnosis)",
                    "event": [
                        {
                            "listen": "prerequest",
                            "script": {
                                "exec": [
                                    "var uuid = require('uuid');",
                                    "pm.environment.set(\"syncDg1Id\", uuid.v4());"
                                ],
                                "type": "text/javascript"
                            }
                        },
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 200\", function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "var jsonData = pm.response.json();",
                                    "pm.test(\"Contains Condition\", function () {",
                                    "    var condition = jsonData.entry.find(e => e.resource.resourceType === \"Condition\");",
                                    "    pm.expect(condition).to.not.be.undefined;",
                                    "    pm.expect(condition.resource.code.coding[0].code).to.eql(\"E11.9\");",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "basic",
                            "basic": [
                                {
                                    "key": "password",
                                    "value": "password123",
                                    "type": "string"
                                },
                                {
                                    "key": "username",
                                    "value": "tenant1",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "text/plain",
                                "type": "text"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "MSH|^~\\&|HIS|RIH|EKG|EkG|199904140038||ADT^A01|{{syncDg1Id}}|P|2.5\rPID|1||103||CONDORN^JANE\rDG1|1|I10|E11.9^Type 2 diabetes mellitus without complications|Type 2 diabetes mellitus|W"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/convert/v2-to-fhir-sync",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "convert",
                                "v2-to-fhir-sync"
                            ]
                        }
                    }
                },
                {
                    "name": "Sync ADT^A01 (Patient + Allergy)",
                    "event": [
                        {
                            "listen": "prerequest",
                            "script": {
                                "exec": [
                                    "var uuid = require('uuid');",
                                    "pm.environment.set(\"syncAl1Id\", uuid.v4());"
                                ],
                                "type": "text/javascript"
                            }
                        },
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 200\", function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "var jsonData = pm.response.json();",
                                    "pm.test(\"Contains AllergyIntolerance\", function () {",
                                    "    var allergy = jsonData.entry.find(e => e.resource.resourceType === 'AllergyIntolerance');",
                                    "    pm.expect(allergy).to.not.be.undefined;",
                                    "    pm.expect(allergy.resource.code.coding[0].code).to.eql('Z88.1');",
                                    "    pm.expect(allergy.resource.category[0]).to.eql('medication');",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "basic",
                            "basic": [
                                {
                                    "key": "password",
                                    "value": "password123",
                                    "type": "string"
                                },
                                {
                                    "key": "username",
                                    "value": "tenant1",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "text/plain",
                                "type": "text"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "MSH|^~\\&|HIS|RIH|EKG|EkG|199904140038||ADT^A01|{{syncAl1Id}}|P|2.5\rPID|1||103||CONDORN^JANE\rAL1|1|DA|Z88.1^Penicillin^CD|MO|Hives"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/convert/v2-to-fhir-sync",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "convert",
                                "v2-to-fhir-sync"
                            ]
                        }
                    }
                },
                {
                    "name": "Sync Bad HL7",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 400\", function () {",
                                    "    pm.response.to.have.status(400);",
                                    "});",
                                    "pm.test(\"Response contains error\", function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData.error).to.not.be.undefined;",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "basic",
                            "basic": [
                                {
                                    "key": "password",
                                    "value": "password123",
                                    "type": "string"
                                },
                                {
                                    "key": "username",
                                    "value": "tenant1",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "text/plain",
                                "type": "text"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "INVALID HEADER|..."
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/convert/v2-to-fhir-sync",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "convert",
                                "v2-to-fhir-sync"
                            ]
                        }
                    }
                }
            ]
        },
        {
            "name": "FHIR to HL7 Conversions",
            "item": [
                {
                    "name": "Async Bundle to HL7",
                    "event": [
                        {
                            "listen": "prerequest",
                            "script": {
                                "exec": [
                                    "var uuid = require('uuid');",
                                    "pm.environment.set(\"asyncBundleId\", uuid.v4());"
                                ],
                                "type": "text/javascript"
                            }
                        },
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 202\", function () {",
                                    "    pm.response.to.have.status(202);",
                                    "});",
                                    "pm.test(\"Response body indicates async processing\", function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData.message).to.eql(\"Processing asynchronously\");",
                                    "    var expectedId = pm.environment.get(\"asyncBundleId\");",
                                    "    pm.expect(jsonData.transactionId).to.eql(expectedId);",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json",
                                "type": "text"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"resourceType\": \"Bundle\",\n  \"id\": \"{{asyncBundleId}}\",\n  \"type\": \"transaction\",\n  \"entry\": [\n    {\n      \"resource\": {\n        \"resourceType\": \"Patient\",\n        \"identifier\": [ { \"value\": \"{{$guid}}\" } ],\n        \"name\": [ { \"family\": \"SKYWALKER\", \"given\": [\"LUKE\"] } ],\n        \"gender\": \"male\"\n      }\n    }\n  ]\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/convert/fhir-to-v2",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "convert",
                                "fhir-to-v2"
                            ]
                        }
                    }
                },
                {
                    "name": "Bundle (Patient + Encounter)",
                    "event": [
                        {
                            "listen": "prerequest",
                            "script": {
                                "exec": [
                                    "var uuid = require('uuid');",
                                    "pm.environment.set(\"syncBundleId\", uuid.v4());"
                                ],
                                "type": "text/javascript"
                            }
                        },
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 200\", function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "var textData = pm.response.text();",
                                    "pm.test(\"Contains MSH, PID, PV1\", function () {",
                                    "    pm.expect(textData).to.include(\"MSH|\");",
                                    "    pm.expect(textData).to.include(\"PID|\");",
                                    "    pm.expect(textData).to.include(\"PV1|\");",
                                    "});",
                                    "pm.test(\"MSH-10 Matches Bundle ID\", function () {",
                                    "    var expectedId = pm.environment.get(\"syncBundleId\");",
                                    "    pm.expect(textData).to.include(\"|\" + expectedId + \"|\");",
                                    "});",
                                    "pm.test(\"Contains Patient Data\", function () {",
                                    "    pm.expect(textData).to.include(\"SMITH\");",
                                    "});",
                                    "pm.test(\"Contains Visit Num\", function () {",
                                    "    pm.expect(textData).to.include(\"VISIT-001\");",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json",
                                "type": "text"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"resourceType\": \"Bundle\",\n  \"id\": \"{{syncBundleId}}\",\n  \"type\": \"transaction\",\n  \"entry\": [\n    {\n      \"resource\": {\n        \"resourceType\": \"Patient\",\n        \"identifier\": [ { \"value\": \"12345\" } ],\n        \"name\": [ { \"family\": \"SMITH\", \"given\": [\"JOHN\"] } ],\n        \"gender\": \"male\"\n      }\n    },\n    {\n      \"resource\": {\n        \"resourceType\": \"Encounter\",\n        \"identifier\": [ { \"value\": \"VISIT-001\" } ],\n        \"class\": { \"code\": \"I\" }\n      }\n    }\n  ]\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/convert/fhir-to-v2-sync",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "convert",
                                "fhir-to-v2-sync"
                            ]
                        }
                    }
                },
                {
                    "name": "Sync Bundle (Patient + Observations)",
                    "event": [
                        {
                            "listen": "prerequest",
                            "script": {
                                "exec": [
                                    "var uuid = require('uuid');",
                                    "pm.environment.set(\"syncObxId\", uuid.v4());"
                                ],
                                "type": "text/javascript"
                            }
                        },
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 200\", function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "var textData = pm.response.text();",
                                    "pm.test(\"Contains OBX Segments\", function () {",
                                    "    pm.expect(textData).to.include(\"OBX|1|NM|8867-4\");",
                                    "    pm.expect(textData).to.include(\"OBX|2|NM|8310-5\");",
                                    "});",
                                    "pm.test(\"Contains Values\", function () {",
                                    "    pm.expect(textData).to.include(\"|70|bpm\");",
                                    "    pm.expect(textData).to.include(\"|36.5|C\");",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json",
                                "type": "text"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"resourceType\": \"Bundle\",\n  \"id\": \"{{syncObxId}}\",\n  \"type\": \"transaction\",\n  \"entry\": [\n    {\n      \"resource\": {\n        \"resourceType\": \"Patient\",\n        \"id\": \"pat-1\",\n        \"identifier\": [ { \"value\": \"12345\" } ],\n        \"name\": [ { \"family\": \"SMITH\", \"given\": [\"JOHN\"] } ],\n        \"gender\": \"male\"\n      }\n    },\n    {\n      \"resource\": {\n        \"resourceType\": \"Observation\",\n        \"status\": \"final\",\n        \"code\": { \"coding\": [ { \"system\": \"http://loinc.org\", \"code\": \"8867-4\", \"display\": \"Heart Rate\" } ] },\n        \"subject\": { \"reference\": \"Patient/pat-1\" },\n        \"valueQuantity\": { \"value\": 70, \"unit\": \"bpm\", \"system\": \"http://unitsofmeasure.org\", \"code\": \"/min\" }\n      }\n    },\n    {\n      \"resource\": {\n        \"resourceType\": \"Observation\",\n        \"status\": \"final\",\n        \"code\": { \"coding\": [ { \"system\": \"http://loinc.org\", \"code\": \"8310-5\", \"display\": \"Body Temperature\" } ] },\n        \"subject\": { \"reference\": \"Patient/pat-1\" },\n        \"valueQuantity\": { \"value\": 36.5, \"unit\": \"C\", \"system\": \"http://unitsofmeasure.org\", \"code\": \"Cel\" }\n      }\n    }\n  ]\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/convert/fhir-to-v2-sync",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "convert",
                                "fhir-to-v2-sync"
                            ]
                        }
                    }
                },
                {
                    "name": "Sync Bundle (Patient + Condition)",
                    "event": [
                        {
                            "listen": "prerequest",
                            "script": {
                                "exec": [
                                    "var uuid = require('uuid');",
                                    "pm.environment.set(\"syncDg1Id\", uuid.v4());"
                                ],
                                "type": "text/javascript"
                            }
                        },
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 200\", function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "var textData = pm.response.text();",
                                    "pm.test(\"Contains DG1 Segment\", function () {",
                                    "    pm.expect(textData).to.include(\"DG1|1||E11.9\");",
                                    "});",
                                    "pm.test(\"Contains Diagnosis Name\", function () {",
                                    "    pm.expect(textData).to.include(\"Type 2 diabetes\");",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json",
                                "type": "text"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"resourceType\": \"Bundle\",\n  \"id\": \"{{syncDg1Id}}\",\n  \"type\": \"transaction\",\n  \"entry\": [\n    {\n      \"resource\": {\n        \"resourceType\": \"Patient\",\n        \"id\": \"pat-1\",\n        \"identifier\": [ { \"value\": \"12345\" } ],\n        \"name\": [ { \"family\": \"SMITH\", \"given\": [\"JOHN\"] } ],\n        \"gender\": \"male\"\n      }\n    },\n    {\n      \"resource\": {\n        \"resourceType\": \"Condition\",\n        \"code\": { \"coding\": [ { \"system\": \"http://hl7.org/fhir/sid/icd-10\", \"code\": \"E11.9\", \"display\": \"Type 2 diabetes mellitus without complications\" } ] },\n        \"subject\": { \"reference\": \"Patient/pat-1\" },\n        \"category\": [ { \"coding\": [ { \"system\": \"http://terminology.hl7.org/CodeSystem/condition-category\", \"code\": \"encounter-diagnosis\", \"display\": \"Admitting Diagnosis\" } ] } ]\n      }\n    }\n  ]\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/convert/fhir-to-v2-sync",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "convert",
                                "fhir-to-v2-sync"
                            ]
                        }
                    }
                },
                {
                    "name": "Sync Bundle (Patient Only)",
                    "event": [
                        {
                            "listen": "prerequest",
                            "script": {
                                "exec": [
                                    "var uuid = require('uuid');",
                                    "pm.environment.set(\"syncBundlePatientId\", uuid.v4());"
                                ],
                                "type": "text/javascript"
                            }
                        },
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 200\", function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "var textData = pm.response.text();",
                                    "pm.test(\"Contains PID\", function () {",
                                    "    pm.expect(textData).to.include(\"PID|\");",
                                    "});",
                                    "pm.test(\"MSH-10 Matches Bundle ID\", function () {",
                                    "    var expectedId = pm.environment.get(\"syncBundlePatientId\");",
                                    "    pm.expect(textData).to.include(\"|\" + expectedId + \"|\");",
                                    "});",
                                    "pm.test(\"Verify PV1 is empty/minimal or absent data\", function () {",
                                    "    // Since we know the code forces ADT^A01, PV1 might form but checks for values\n    pm.expect(textData).to.not.include(\"VISIT-001\");\n});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json",
                                "type": "text"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"resourceType\": \"Bundle\",\n  \"id\": \"{{syncBundlePatientId}}\",\n  \"type\": \"transaction\",\n  \"entry\": [\n    {\n      \"resource\": {\n        \"resourceType\": \"Patient\",\n        \"identifier\": [ { \"value\": \"99999\" } ],\n        \"name\": [ { \"family\": \"SOLO\", \"given\": [\"HAN\"] } ],\n        \"gender\": \"male\"\n      }\n    }\n  ]\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/convert/fhir-to-v2-sync",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "convert",
                                "fhir-to-v2-sync"
                            ]
                        }
                    }
                },
                {
                    "name": "Sync Malformed FHIR",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 400\", function () {",
                                    "    pm.response.to.have.status(400);",
                                    "});",
                                    "pm.test(\"Contains Error Message\", function () {",
                                    "    pm.expect(pm.response.text()).to.match(/Error|error/);",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json",
                                "type": "text"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{ \"resourceType\": \"Bundle\", \"broken_json\": "
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/convert/fhir-to-v2-sync",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "convert",
                                "fhir-to-v2-sync"
                            ]
                        }
                    }
                },
                {
                    "name": "Sync Non-Bundle FHIR",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 400\", function () {",
                                    "    pm.response.to.have.status(400);",
                                    "});",
                                    "pm.test(\"Contains Error\", function () {",
                                    "    pm.expect(pm.response.text()).to.include(\"Error\");",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json",
                                "type": "text"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"resourceType\": \"Patient\",\n  \"id\": \"123\",\n  \"name\": [ { \"family\": \"TEST\" } ]\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/convert/fhir-to-v2-sync",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "convert",
                                "fhir-to-v2-sync"
                            ]
                        }
                    }
                }
            ]
        },
        {
            "name": "Operations",
            "item": [
                {
                    "name": "Health Check",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 200\", function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "pm.test(\"Status is UP\", function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData.status).to.eql(\"UP\");",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{baseUrl}}/actuator/health",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "actuator",
                                "health"
                            ]
                        }
                    }
                },
                {
                    "name": "Metrics",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 200\", function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{baseUrl}}/actuator/metrics",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "actuator",
                                "metrics"
                            ]
                        }
                    }
                }
            ]
        },
        {
            "name": "Negative & Security Tests",
            "item": [
                {
                    "name": "RBAC: Tenant cannot List Tenants",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 403\", function () {",
                                    "    pm.response.to.have.status(403);",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "basic",
                            "basic": [
                                {
                                    "key": "password",
                                    "value": "password123",
                                    "type": "string"
                                },
                                {
                                    "key": "username",
                                    "value": "tenant1",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{baseUrl}}/api/tenants",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "tenants"
                            ]
                        }
                    }
                },
                {
                    "name": "RBAC: Tenant cannot Onboard",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 403\", function () {",
                                    "    pm.response.to.have.status(403);",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "basic",
                            "basic": [
                                {
                                    "key": "password",
                                    "value": "password123",
                                    "type": "string"
                                },
                                {
                                    "key": "username",
                                    "value": "tenant1",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json",
                                "type": "text"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"tenantId\": \"hacker\",\n    \"password\": \"pass\",\n    \"name\": \"Hacker Tenant\"\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/tenants/onboard",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "tenants",
                                "onboard"
                            ]
                        }
                    }
                },
                {
                    "name": "Validation: Invalid Onboard Request",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 400\", function () {",
                                    "    pm.response.to.have.status(400);",
                                    "});",
                                    "var jsonData = pm.response.json();",
                                    "pm.test(\"Error is Validation Error\", function () {",
                                    "    pm.expect(jsonData.error).to.eql(\"Validation Error\");",
                                    "});",
                                    "pm.test(\"Contains Details\", function () {",
                                    "    pm.expect(jsonData.details).to.not.be.undefined;",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "basic",
                            "basic": [
                                {
                                    "key": "password",
                                    "value": "password",
                                    "type": "string"
                                },
                                {
                                    "key": "username",
                                    "value": "admin",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json",
                                "type": "text"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"tenantId\": \"\",\n    \"password\": \"123\",\n    \"name\": \"\"\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/tenants/onboard",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "tenants",
                                "onboard"
                            ]
                        }
                    }
                },
                {
                    "name": "NotFound: Delete Non-Existent Tenant",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 404\", function () {",
                                    "    pm.response.to.have.status(404);",
                                    "});",
                                    "var jsonData = pm.response.json();",
                                    "pm.test(\"Error is Not Found\", function () {",
                                    "    pm.expect(jsonData.error).to.eql(\"Not Found\");",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "basic",
                            "basic": [
                                {
                                    "key": "password",
                                    "value": "password",
                                    "type": "string"
                                },
                                {
                                    "key": "username",
                                    "value": "admin",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "DELETE",
                        "header": [],
                        "url": {
                            "raw": "{{baseUrl}}/api/tenants/invalid-id-999",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "tenants",
                                "invalid-id-999"
                            ]
                        }
                    }
                }
            ]
        },
        {
            "name": "Tenant Teardown",
            "item": [
                {
                    "name": "Get Tenant Transactions",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 200\", function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "pm.test(\"Returns summary object\", function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData).to.have.property('totalCount');",
                                    "    pm.expect(jsonData).to.have.property('totalPages');",
                                    "    pm.expect(jsonData).to.have.property('currentPage');",
                                    "    pm.expect(jsonData).to.have.property('statusCounts');",
                                    "    pm.expect(jsonData.statusCounts).to.be.an('object');",
                                    "    pm.expect(jsonData).to.have.property('transactions');",
                                    "    pm.expect(jsonData.transactions).to.be.an('array');",
                                    "    if (jsonData.transactions.length > 0) {",
                                    "        pm.expect(jsonData.transactions[0]).to.have.property('fhirTransformerId');",
                                    "        pm.expect(jsonData.transactions[0]).to.have.property('originalMessageId');",
                                    "        pm.expect(jsonData.transactions[0]).to.have.property('status');",
                                    "    }",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "basic",
                            "basic": [
                                {
                                    "key": "password",
                                    "value": "password",
                                    "type": "string"
                                },
                                {
                                    "key": "username",
                                    "value": "admin",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{baseUrl}}/api/tenants/tenant1/transactions?startDate=2000-01-01T00:00:00&endDate=2100-01-01T00:00:00",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "tenants",
                                "tenant1",
                                "transactions"
                            ],
                            "query": [
                                {
                                    "key": "startDate",
                                    "value": "2000-01-01T00:00:00"
                                },
                                {
                                    "key": "endDate",
                                    "value": "2100-01-01T00:00:00"
                                }
                            ]
                        }
                    }
                },
                {
                    "name": "Update Tenant",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 200\", function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "var jsonData = pm.response.json();",
                                    "pm.test(\"Name is updated\", function () {",
                                    "    pm.expect(jsonData.name).to.eql(\"Updated Hospital Name\");",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "basic",
                            "basic": [
                                {
                                    "key": "password",
                                    "value": "password",
                                    "type": "string"
                                },
                                {
                                    "key": "username",
                                    "value": "admin",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "PUT",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json",
                                "type": "text"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"name\": \"Updated Hospital Name\"\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/tenants/tenant1",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "tenants",
                                "tenant1"
                            ]
                        }
                    }
                },
                {
                    "name": "Delete Tenant",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 200\", function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "basic",
                            "basic": [
                                {
                                    "key": "password",
                                    "value": "password",
                                    "type": "string"
                                },
                                {
                                    "key": "username",
                                    "value": "admin",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "DELETE",
                        "header": [],
                        "url": {
                            "raw": "{{baseUrl}}/api/tenants/tenant1",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "tenants",
                                "tenant1"
                            ]
                        }
                    }
                }
            ]
        }
    ],
    "variable": [
        {
            "key": "baseUrl",
            "value": "http://localhost:8080",
            "type": "string"
        }
    ]
}